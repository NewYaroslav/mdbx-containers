# mdbx-containers

**mdbx-containers** ‚Äî —ç—Ç–æ –ª—ë–≥–∫–∞—è –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞ C++11/C++17, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö [libmdbx](https://github.com/erthink/libmdbx) —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã STL: `std::map`, `std::set`, `std::unordered_map`, `std::vector` –∏ –¥—Ä.

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å in-memory –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ MDBX, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

---

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### üß© –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü: `insert`, `insert_or_assign`, `find`, `erase`, `clear`, `load`, `reconcile`, `operator[]` –∏ –¥—Ä.
- –ß–µ—Ç—ã—Ä–µ —Ç–∏–ø–∞ —Ç–∞–±–ª–∏—Ü:
  - `KeyTable<K>` ‚Äî —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏;
  - `KeyValueTable<K, V>` ‚Äî –æ–¥–∏–Ω `V` –Ω–∞ –∫–ª—é—á;
  - `KeyMultiValueTable<K, V>` ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ `V` –Ω–∞ –∫–ª—é—á (`std::multimap`);
  - `AnyValueTable<K>` ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞.

### üîÑ –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ç–∏–ø—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è:
  - trivially copyable —Ç–∏–ø—ã ‚Äî –ø–æ –ø–∞–º—è—Ç–∏;
  - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ ‚Äî —á–µ—Ä–µ–∑ `to_bytes()` / `from_bytes()`;
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ STL-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: `std::string`, `std::vector`, `std::list`, `std::set`, `std::vector<std::pair<K, V>>` –∏ –¥—Ä.

### üßµ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
- RAII-–æ–±—ë—Ä—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (`Transaction`);
- –ü—Ä–∏–≤—è–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫ –ø–æ—Ç–æ–∫—É (`std::thread`);
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ (—á–µ—Ä–µ–∑ `TransactionTracker`, `std::mutex`).

### üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ç–∞–±–ª–∏—Ü –≤ –æ–¥–Ω–æ–º MDBX-—Ñ–∞–π–ª–µ (—á–µ—Ä–µ–∑ `MDBX_dbi`);
- –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
  - `read_only`, `writemap_mode`, `readahead`, `no_subdir`, `sync_durable`,
    `max_readers`, `max_dbs`, `relative_to_exe`.
  - –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º. –≤ —Ñ–∞–π–ª–µ `docs/configuration.dox`.

### ‚öôÔ∏è –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (header-only);
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ [libmdbx](https://github.com/erthink/libmdbx);
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: C++11 –∏ –≤—ã—à–µ.

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Å–±–æ—Ä–∫–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É `include/` –≤ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–∞–∫ submodule.
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `libmdbx` –¥–æ—Å—Ç—É–ø–Ω–∞ —Å–∏—Å—Ç–µ–º–µ (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `MDBXC_DEPS_MODE=BUNDLED` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏).
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ C++11 –∏ –≤—ã—à–µ.

### –°–±–æ—Ä–∫–∞ —á–µ—Ä–µ–∑ CMake

```bash
cmake -S . -B build \
    -DMDBXC_DEPS_MODE=BUNDLED \
    -DMDBXC_BUILD_STATIC_LIB=ON \
    -DMDBXC_BUILD_TESTS=ON \
    -DMDBXC_BUILD_EXAMPLES=ON \
    -DMDBXC_USE_ASAN=ON \
    -DCMAKE_CXX_STANDARD=17
cmake --build build
ctest --test-dir build --output-on-failure
```


–î–ª—è Windows –¥–æ—Å—Ç—É–ø–Ω—ã `.bat`‚Äë—Å–∫—Ä–∏–ø—Ç—ã —Å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (`build-mingw-17-examples.bat`, `build-mingw-17-tests.bat`, `build-mingw-11-tests.bat`).

---

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ

```cpp
#include <mdbx_containers/KeyValueTable.hpp>
#include <iostream>
#include <map>

int main() {
    mdbxc::Config config;
    config.pathname = "example.mdbx";
    config.max_dbs = 4;

    auto conn = mdbxc::Connection::create(config);
    mdbxc::KeyValueTable<int, std::string> table(conn, "my_map");

    table.insert_or_assign(1, "Hello");
    table.insert_or_assign(2, "World");

    std::map<int, std::string> result;
    table.load(result);

    for (const auto& pair : result)
        std::cout << pair.first << ": " << pair.second << "\n";

    return 0;
}
```

### –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π

```cpp
mdbxc::Config config;
config.pathname = "txn.mdbx";
auto conn = mdbxc::Connection::create(config);
mdbxc::KeyValueTable<int, std::string> table(conn, "demo");

conn->begin(mdbxc::TransactionMode::WRITABLE);
table.insert_or_assign(10, "ten");
conn->commit();
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```cpp
struct MyData {
    int id;
    double value;

    std::vector<uint8_t> to_bytes() const {
        std::vector<uint8_t> bytes(sizeof(MyData));
        std::memcpy(bytes.data(), this, sizeof(MyData));
        return bytes;
    }

    static MyData from_bytes(const void* data, size_t size) {
        MyData out{};
        std::memcpy(&out, data, sizeof(MyData));
        return out;
    }
};

mdbxc::KeyValueTable<int, MyData> table(conn, "my_data");
table.insert_or_assign(42, MyData{42, 3.14});
```

üìò –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Å–º. –≤ –ø–∞–ø–∫–µ examples/.
- API –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–ø–∏—Å–∞–Ω—ã –≤ Wiki (–µ—Å–ª–∏ –µ—Å—Ç—å).
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤–æ–∑–º–æ–∂–Ω–∞ —Å Doxygen.

ü™™ –õ–∏—Ü–µ–Ω–∑–∏—è
–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.

–í —Å–æ—Å—Ç–∞–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤–∫–ª—é—á–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ [libmdbx](https://github.com/erthink/libmdbx), —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º–∞—è –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ Apache License 2.0. –§–∞–π–ª –ª–∏—Ü–µ–Ω–∑–∏–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ `docs/libmdbx.LICENSE`.
